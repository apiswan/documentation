## Prerequisites

Before you begin, make sure you have the following prerequisites in place:

- Docker installed on your host machine.
- A Dockerized version of your main application.
- Familiarity with Docker and containerization concepts.

## Step 1: Create Docker Compose Configuration

1. Create a Docker Compose YAML file (e.g., `docker-compose.yml`) to define your main application and GoReplay containers. Here's an example configuration:

```yaml
version: '3'
services:
  main-app:
    image: your-main-app-image:latest
    ports:
      - "8080:8080"
    # Add other configuration options for your main app if needed

  goreplay:
    image: goreplay/goreplay
    command: [
      "--input-raw", ":8080",
      "--input-raw-track-response",
      "--output-file", "swan-%d-%H-%M-%S.log"
    ]
    # Add other GoReplay configuration options if needed
```

In this example, we have two services: `main-app` and [`goreplay`](https://github.com/buger/goreplay). The `main-app` service runs your main application, and the `goreplay` service runs the GoReplay container as a sidecar. GoReplay is configured to capture traffic on port 8080 and logs it as .log files.

2. Save the Docker Compose file in your project directory.

## Step 2: Build and Run the Docker Containers

1. Open a terminal and navigate to the directory where your Docker Compose file is located.

2. Build the Docker containers:

```bash
docker-compose build
```

3. Start the containers:

```bash
docker-compose up
```

Your main application and GoReplay containers will start running in the same Docker network.

## Step 3: Testing

1. To verify that GoReplay is capturing and forwarding traffic as expected, you can make HTTP requests to your main application:

   ```bash
   curl http://localhost:8080
   ```

   Observe the traffic capture in the GoReplay container's logs.

2. Test your application as you normally would, and check for `swan-*.log` files generated by GoReplay to capture traffic.

## Step 4: Monitoring and Logging

You can monitor and log the behavior of your main application and GoReplay as needed. Consider configuring logging options within your main application and using Docker logging for the GoReplay container.

## Step 5: Cleanup

To stop and remove the Docker containers when you're finished, run the following command in the same directory as your Docker Compose file:

```bash
docker-compose down
```

## Conclusion

Congratulations! You've successfully set up GoReplay as a sidecar container alongside your main application in a Docker environment. This setup allows you to simplifies the process of capturing and examining network traffic, which will be utilized by the APISwan agent to autonomously create regression reports. Adjust the Docker Compose configuration and GoReplay options to meet your specific requirements.
